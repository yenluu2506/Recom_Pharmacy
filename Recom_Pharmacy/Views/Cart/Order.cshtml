@using Recom_Pharmacy.Models
@model List<CartEntity>
@{
    ViewBag.Title = "Order";
    Layout = "~/Views/Shared/_LayoutHomePage.cshtml";
}

@{
    KHACHHANG cus = (KHACHHANG)Session["usr"];
}
<div class="bg-light py-3">
    <div class="container">
        <div class="row">
            <div class="col-md-12 mb-0">
                <a href="index.html">Home</a> <span class="mx-2 mb-0">/</span>
                <strong class="text-black">Checkout</strong>
            </div>
        </div>
    </div>
</div>

<div class="site-section">
    <div class="container">
        <div class="row">
            <div class="col-md-6 mb-5 mb-md-0">
                <h2 class="h3 mb-3 text-black">Chi tiết thanh toán</h2>
                <div class="p-3 p-lg-5 border">
                    @using (Html.BeginForm())
                    {

                        @Html.ValidationSummary(true)
                        <div class="form-group">
                            <label for="c_country" class="text-black">Họ tên<span class="text-danger">*</span></label>
                            <input type="text" value="@cus.TENKH" class="form-control" id="c_companyname" name="c_companyname">
                        </div>
                        <div class="form-group">
                            <label for="c_fname" class="text-black">Giới tính <span class="text-danger">*</span></label>
                            <input type="text" value="@cus.GIOITINH" class="form-control" id="c_companyname" name="c_companyname">
                        </div>

                        <div class="form-group row">
                            <div class="col-md-12">
                                <label for="c_companyname" class="text-black">Số điện thoại </label>
                                <input type="text" value="@cus.SDT" class="form-control" id="c_companyname" name="c_companyname">
                            </div>
                        </div>

                        <div class="form-group row">
                            <div class="col-md-12">
                                <label for="c_address" class="text-black">Địa chỉ <span class="text-danger">*</span></label>
                            </div>
                        </div>

                        <div class="form-group">
                            <input type="text" value="@cus.DIACHI" class="form-control" placeholder="Apartment, suite, unit etc. (optional)">
                        </div>
                        <div class="form-group row">
                            <div class="col-md-12">
                                <label for="c_companyname" class="text-black">Ngày đặt hàng </label>
                                <input type="text" value="@DateTime.Now.ToShortDateString()" class="form-control" id="c_companyname" name="c_companyname">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Hình thức thanh toán</label>
                            <select class="form-control" name="TypePayment" id="drTypePayment">
                                <option value="1" selected>COD</option>
                                <option value="2">Chuyển khoản</option>
                            </select>
                        </div>
                        <div class="form-group" id="load_form_payment" style="display:none;">
                            <h4> <label>Chọn phương thức thanh toán:</label><br /></h4>
                            <h5>Cách 1: Chuyển hướng sang VNPAY chọn phương thức thanh toán</h5>
                            <label><input type="radio" name="TypePaymentVN" value="0" checked /> Cổng thanh toán VNPAYQR </label>
                            <h5>Cách 2: Tách phương thức thanh toán tại site của Merchant</h5>
                            <label><input type="radio" name="TypePaymentVN" value="1" /> Thanh toán qua ứng dụng hỗ trợ VNPAYQR </label><br />
                            <label><input type="radio" name="TypePaymentVN" value="2" /> ATM-Tài khoản ngân hàng nội địa </label><br />
                            <label><input type="radio" name="TypePaymentVN" value="3" /> Thanh toán qua thẻ quốc tế </label><br />
                        </div>
                        <div class="form-group" id="load_send"></div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary btn-lg btn-block" id="btnCheckOut">
                                Đặt hàng
                            </button>
                        </div>
                        <input type="number" name="pointsToUse" value=@ViewBag.PointsUsed hidden />
                    }
                </div>
            </div>
            <div class="col-md-6">

                <div class="row mb-5">
                    <div class="col-md-12">
                        <h2 class="h3 mb-3 text-black">Đơn hàng</h2>
                        <div class="p-3 p-lg-5 border">
                            <table class="table site-block-order-table mb-5">
                                <thead>
                                    <tr>
                                        <th>Sản phẩm</th>
                                        <th>ĐVT</th>
                                        <th>Thành tiền</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td>@item.tenThuoc <strong class="mx-2">x</strong> @item.soLuong</td>
                                            <td>@item.tendvt</td>
                                            <td>@String.Format("{0:0,0}", @item.tongGia)</td>
                                        </tr>

                                    }
                                    <tr>
                                        <td class="text-black font-weight-bold">Giảm giá</td>
                                        <td class="text-black">@String.Format("{0:0,0}", ViewBag.PointsUsed)</td>
                                    </tr>
                                    <tr>
                                        <td class="text-black font-weight-bold">Tổng tiền đặt hàng</td>
                                        <td class="text-black">@String.Format("{0:0,0}", ViewBag.FinalPriceAfterPoints)</td>
                                    </tr>
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- </form> -->
    </div>
</div>

@section scripts{
    <script src="~/Content/assets/js/categories_custom.js"></script>
    <script>
        function OnFailure(rs) {
            if (!rs.Success) {
                $('#show_success').html("Bạn mua hàng thất bại! Xin vui lòng thử lại");
            }
        }
        $(document).ready(function () {
            $('body').on('change', '#drTypePayment', function () {
                var type = $(this).val();
                $('#load_form_payment').hide();
                if (type == "2") {
                    $('#load_form_payment').show();
                }
            });
        });
    </script>
    <script>
        function OnBeginCO() {
            $('#btnCheckOut').attr("disabled", "disabled");
            $('#load_send').html('<h2>Đang gửi....</h2>');
        }
        function OnSuccessCO(res) {
            if (res.Success) {
                if (res.Code == 1) {
                    location.href = "/Cart/OrderConfirmation";
                }
                else {
                    location.href = res.Url;
                }
            }
        }
                //function OnFailure() {

                //}
    </script>
}